{"ast":null,"code":"(() => {\n  function getNumberOrDef(val, def) {\n    return typeof val === 'number' && !isNaN(val) ? val : def;\n  }\n\n  function isVisible(element) {\n    return element && element.style.visibility !== 'hidden';\n  }\n\n  function inside(minX, minY, maxX, maxY, x1, y1) {\n    return minX <= x1 && x1 <= maxX && minY <= y1 && y1 <= maxY;\n  }\n\n  function intersectionPoint(x1, y1, x2, y2, minX, minY, maxX, maxY) {\n    var min = Math.min,\n        max = Math.max;\n    var good = inside.bind(null, min(x1, x2), min(y1, y2), max(x1, x2), max(y1, y2));\n    if (x1 <= minX && x2 <= minX || y1 <= minY && y2 <= minY || x1 >= maxX && x2 >= maxX || y1 >= maxY && y2 >= maxY || inside(minX, minY, maxX, maxY, x1, y1) && inside(minX, minY, maxX, maxY, x2, y2)) return null;\n    var m = (y2 - y1) / (x2 - x1);\n    var y = m * (minX - x1) + y1;\n    if (minY < y && y < maxY && good(minX, y)) return {\n      x: minX,\n      y: y\n    };\n    y = m * (maxX - x1) + y1;\n    if (minY < y && y < maxY && good(maxX, y)) return {\n      x: maxX,\n      y: y\n    };\n    var x = (minY - y1) / m + x1;\n    if (minX < x && x < maxX && good(x, minY)) return {\n      x: x,\n      y: minY\n    };\n    x = (maxY - y1) / m + x1;\n    if (minX < x && x < maxX && good(x, maxY)) return {\n      x: x,\n      y: maxY\n    };\n    return null;\n  }\n\n  function adjustLine(from, to, line, trafo) {\n    var color = trafo && trafo.color || 'black';\n    var W = trafo && trafo.width || 2;\n    var fromB = parseFloat(from.style.top) ? null : from.getBoundingClientRect();\n    var toB = parseFloat(to.style.top) ? null : to.getBoundingClientRect();\n    var fromBStartY = fromB ? window.scrollY + fromB.top : parseFloat(from.style.top);\n    var fromBStartX = fromB ? window.scrollX + fromB.left : parseFloat(from.style.left);\n    var toBStartY = toB ? window.scrollY + toB.top : parseFloat(to.style.top);\n    var toBStartX = toB ? window.scrollX + toB.left : parseFloat(to.style.left);\n    var fromBWidth = fromB ? fromB.width : parseFloat(from.style.width) || from.offsetWidth;\n    var fromBHeight = fromB ? fromB.height : parseFloat(from.style.height) || from.offsetHeight;\n    var toBWidth = toB ? toB.width : parseFloat(to.style.width) || to.offsetWidth;\n    var toBHeight = toB ? toB.height : parseFloat(to.style.height) || to.offsetHeight;\n    var fT = fromBStartY + fromBHeight * getNumberOrDef(trafo && trafo.fromY, getNumberOrDef(trafo, 0.5));\n    var tT = toBStartY + toBHeight * getNumberOrDef(trafo && trafo.toY, getNumberOrDef(trafo, 0.5));\n    var fL = fromBStartX + fromBWidth * getNumberOrDef(trafo && trafo.fromX, getNumberOrDef(trafo, 0.5));\n    var tL = toBStartX + toBWidth * getNumberOrDef(trafo && trafo.toX, getNumberOrDef(trafo, 0.5));\n    var CA = Math.abs(tT - fT);\n    var CO = Math.abs(tL - fL);\n    var H = Math.sqrt(CA * CA + CO * CO);\n    var ANG = 180 / Math.PI * Math.acos(CO / H);\n\n    if ((fT >= tT || fL >= tL) && (tT >= fT || tL >= fL)) {\n      ANG *= -1;\n    }\n\n    if (trafo && trafo.onlyVisible) {\n      var arrangeFrom = intersectionPoint(fL, fT, tL, tT, fromBStartX, fromBStartY, fromBStartX + fromBWidth, fromBStartY + fromBHeight);\n      var arrangeTo = intersectionPoint(fL, fT, tL, tT, toBStartX, toBStartY, toBStartX + toBWidth, toBStartY + toBHeight);\n\n      if (arrangeFrom) {\n        fL = arrangeFrom.x;\n        fT = arrangeFrom.y;\n      }\n\n      if (arrangeTo) {\n        tL = arrangeTo.x;\n        tT = arrangeTo.y;\n      }\n\n      CA = Math.abs(tT - fT);\n      CO = Math.abs(tL - fL);\n      H = Math.sqrt(CA * CA + CO * CO);\n    }\n\n    var top = (tT + fT) / 2 - W / 2;\n    var left = (tL + fL) / 2 - H / 2;\n    var arrows = [...line.getElementsByClassName('arrow')];\n    var needSwap = fL > tL || fL == tL && fT < tT;\n    var arrowFw = needSwap && isVisible(arrows[0]) && arrows[0] || !needSwap && isVisible(arrows[1]) && arrows[1];\n    var arrowBw = !needSwap && isVisible(arrows[0]) && arrows[0] || needSwap && isVisible(arrows[1]) && arrows[1];\n\n    if (arrowFw) {\n      arrowFw.classList.remove('arrow-bw');\n      arrowFw.classList.add('arrow-fw');\n      arrowFw.style.borderRightColor = color;\n      arrowFw.style.top = W / 2 - 6 + \"px\";\n    }\n\n    if (arrowBw) {\n      arrowBw.classList.remove('arrow-fw');\n      arrowBw.classList.add('arrow-bw');\n      arrowBw.style.borderLeftColor = color;\n      arrowBw.style.top = W / 2 - 6 + \"px\";\n    }\n\n    line.style.display = \"none\";\n    line.style[\"-webkit-transform\"] = 'rotate(' + ANG + 'deg)';\n    line.style[\"-moz-transform\"] = 'rotate(' + ANG + 'deg)';\n    line.style[\"-ms-transform\"] = 'rotate(' + ANG + 'deg)';\n    line.style[\"-o-transform\"] = 'rotate(' + ANG + 'deg)';\n    line.style[\"-transform\"] = 'rotate(' + ANG + 'deg)';\n    line.style.top = top + 'px';\n    line.style.left = left + 'px';\n    line.style.width = H + 'px';\n    line.style.height = W + 'px';\n    line.style.background = \"linear-gradient(to right, \" + (arrowFw ? \"transparent\" : color) + \" 11px, \" + color + \" 11px \" + (H - 11) + \"px, \" + (arrowBw ? \"transparent\" : color) + \" \" + (H - 11) + \"px 100%)\";\n    line.style.display = \"initial\";\n  }\n\n  function repaintConnection(connectionElement) {\n    var fromQ = connectionElement.getAttribute('from');\n    var fromE = document.querySelector(fromQ);\n    var toQ = connectionElement.getAttribute('to');\n    var toE = document.querySelector(toQ);\n    connectedObserver.observe(fromE, {\n      attributes: true\n    });\n    connectedObserver.observe(toE, {\n      attributes: true\n    });\n    var lineE = connectionElement.getElementsByClassName('line')[0];\n\n    if (!lineE) {\n      lineE = document.createElement('div');\n      lineE.classList.add('line');\n      connectionElement.appendChild(lineE);\n    }\n\n    var needTail = connectionElement.hasAttribute('tail');\n    var needHead = connectionElement.hasAttribute('head');\n    var arrows = lineE.getElementsByClassName('arrow');\n    var tail = arrows[0];\n    var head = arrows[1];\n\n    if (!tail && (needHead || needTail)) {\n      tail = document.createElement('div');\n      tail.classList.add('arrow');\n      lineE.appendChild(tail);\n    }\n\n    if (!head && needHead) {\n      head = document.createElement('div');\n      head.classList.add('arrow');\n      lineE.appendChild(head);\n    }\n\n    tail && (tail.style.visibility = needTail ? 'visible' : 'hidden');\n    head && (head.style.visibility = needHead ? 'visible' : 'hidden');\n    var textE = lineE.getElementsByClassName('text')[0];\n    var textMessage = connectionElement.getAttribute('text');\n\n    if (!textE && textMessage) {\n      textE = document.createElement('div');\n      textE.classList.add('text');\n      lineE.appendChild(textE);\n    }\n\n    if (textE && textE.innerText != textMessage) {\n      textE.innerText = textMessage;\n    }\n\n    adjustLine(fromE, toE, lineE, {\n      color: connectionElement.getAttribute('color'),\n      onlyVisible: connectionElement.hasAttribute('onlyVisible'),\n      fromX: parseFloat(connectionElement.getAttribute('fromX')),\n      fromY: parseFloat(connectionElement.getAttribute('fromY')),\n      toX: parseFloat(connectionElement.getAttribute('toX')),\n      toY: parseFloat(connectionElement.getAttribute('toY')),\n      width: parseFloat(connectionElement.getAttribute('width'))\n    });\n  }\n\n  function repaintWithoutObserve(tag) {\n    connectionObserver.observe(tag, {\n      attributeFilter: []\n    });\n    repaintConnection(tag);\n    connectionObserver.observe(tag, {\n      attributes: true,\n      childList: true,\n      subtree: true\n    });\n  }\n\n  function createOne(newElement) {\n    connectionElements.push(newElement);\n    repaintConnection(newElement);\n    connectionObserver.observe(newElement, {\n      attributes: true,\n      childList: true,\n      subtree: true\n    });\n  }\n\n  function create() {\n    bodyObserver.observe(document.body, {\n      childList: true,\n      subtree: true\n    });\n    [...document.body.getElementsByTagName('connection')].forEach(createOne);\n  }\n\n  function removeConnection(tag) {\n    for (var i = connectionElements.length - 1; i >= 0; i--) if (connectionElements[i] === tag) connectionElements.splice(i, 1);\n\n    connectionObserver.observe(tag, {\n      attributeFilter: []\n    });\n  }\n\n  function changedConnectedTag(changes) {\n    changes.forEach(e => {\n      var changedElem = e.target;\n      var wasConnection = false;\n\n      for (var i = 0; i < connectionElements.length; ++i) {\n        var fromE = document.querySelector(connectionElements[i].getAttribute('from'));\n\n        if (fromE === changedElem) {\n          wasConnection = true;\n          repaintWithoutObserve(connectionElements[i]);\n          continue;\n        }\n\n        var toE = document.querySelector(connectionElements[i].getAttribute('to'));\n\n        if (toE === changedElem) {\n          wasConnection = true;\n          repaintWithoutObserve(connectionElements[i]);\n        }\n      }\n\n      if (!wasConnection) {\n        connectionObserver.observe(changedElem, {\n          attributeFilter: []\n        });\n      }\n    });\n  }\n\n  function changedConnectionTag(changes) {\n    changes.forEach(e => {\n      var conn = e.target;\n      if (conn.tagName.toLowerCase() !== 'connection' && e.attributeName === 'class') ;\n\n      while (conn && conn.tagName.toLowerCase() !== 'connection') conn = conn.parentElement;\n\n      if (!conn) return;\n      repaintWithoutObserve(conn);\n    });\n  }\n\n  function bodyNewElement(changes) {\n    changes.forEach(e => {\n      e.removedNodes.forEach(n => {\n        if (n.tagName && n.tagName.toLowerCase() === 'connection') removeConnection(n);\n      });\n      e.addedNodes.forEach(n => {\n        if (n.tagName && n.tagName.toLowerCase() === 'connection') createOne(n);\n      });\n    });\n  }\n\n  var connectionElements = [];\n  var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;\n  var bodyObserver = new MutationObserver(bodyNewElement);\n  var connectionObserver = new MutationObserver(changedConnectionTag);\n  var connectedObserver = new MutationObserver(changedConnectedTag);\n  document.body && create() || window.addEventListener(\"load\", create);\n})();","map":{"version":3,"sources":["/Users/juvenal/Desktop/projects/StructureVisualizer/structure-vis/src/domarrow.js"],"names":["getNumberOrDef","val","def","isNaN","isVisible","element","style","visibility","inside","minX","minY","maxX","maxY","x1","y1","intersectionPoint","x2","y2","min","Math","max","good","bind","m","y","x","adjustLine","from","to","line","trafo","color","W","width","fromB","parseFloat","top","getBoundingClientRect","toB","fromBStartY","window","scrollY","fromBStartX","scrollX","left","toBStartY","toBStartX","fromBWidth","offsetWidth","fromBHeight","height","offsetHeight","toBWidth","toBHeight","fT","fromY","tT","toY","fL","fromX","tL","toX","CA","abs","CO","H","sqrt","ANG","PI","acos","onlyVisible","arrangeFrom","arrangeTo","arrows","getElementsByClassName","needSwap","arrowFw","arrowBw","classList","remove","add","borderRightColor","borderLeftColor","display","background","repaintConnection","connectionElement","fromQ","getAttribute","fromE","document","querySelector","toQ","toE","connectedObserver","observe","attributes","lineE","createElement","appendChild","needTail","hasAttribute","needHead","tail","head","textE","textMessage","innerText","repaintWithoutObserve","tag","connectionObserver","attributeFilter","childList","subtree","createOne","newElement","connectionElements","push","create","bodyObserver","body","getElementsByTagName","forEach","removeConnection","i","length","splice","changedConnectedTag","changes","e","changedElem","target","wasConnection","changedConnectionTag","conn","tagName","toLowerCase","attributeName","parentElement","bodyNewElement","removedNodes","n","addedNodes","MutationObserver","WebKitMutationObserver","MozMutationObserver","addEventListener"],"mappings":"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","sourcesContent":["(()=>{\n  function getNumberOrDef(val, def) {\n    return typeof val === 'number' && !isNaN(val) ? val : def;\n  }\n\n  function isVisible(element) {\n    return element && element.style.visibility !== 'hidden';\n  }\n\n  function inside(minX, minY, maxX, maxY, x1, y1) {\n\t  return minX <= x1 && x1 <= maxX && minY <= y1 && y1 <= maxY;\n  }\n\n  function intersectionPoint (x1, y1, x2, y2, minX, minY, maxX, maxY) {\n    var min = Math.min, max = Math.max;\n    var good = inside.bind(null, min(x1, x2), min(y1, y2), max(x1, x2), max(y1, y2));\n\n    if ((x1 <= minX && x2 <= minX) || (y1 <= minY && y2 <= minY) || (x1 >= maxX && x2 >= maxX) || (y1 >= maxY && y2 >= maxY) || (inside(minX, minY, maxX, maxY, x1, y1) && inside(minX, minY, maxX, maxY, x2, y2)))\n      return null;\n\n    var m = (y2 - y1) / (x2 - x1);\n    var y = m * (minX - x1) + y1;\n    if (minY < y && y < maxY && good(minX, y)) return {x: minX, y:y};\n\n    y = m * (maxX - x1) + y1;\n    if (minY < y && y < maxY && good(maxX, y)) return {x: maxX, y:y};\n\n    var x = (minY - y1) / m + x1;\n    if (minX < x && x < maxX && good(x, minY)) return {x: x, y:minY};\n\n    x = (maxY - y1) / m + x1;\n    if (minX < x && x < maxX && good(x, maxY)) return {x: x, y:maxY};\n\n    return null;\n  }\n\n\n  function adjustLine(from, to, line, trafo){\n    var color = trafo && trafo.color || 'black';\n    var W = trafo && trafo.width || 2;\n\n    var fromB = parseFloat(from.style.top) ? null : from.getBoundingClientRect();\n    var toB = parseFloat(to.style.top) ? null : to.getBoundingClientRect();\n    var fromBStartY = (fromB ? window.scrollY + fromB.top : parseFloat(from.style.top));\n    var fromBStartX = (fromB ? window.scrollX + fromB.left : parseFloat(from.style.left));\n    var toBStartY = (toB ? window.scrollY + toB.top : parseFloat(to.style.top));\n    var toBStartX = (toB ? window.scrollX + toB.left : parseFloat(to.style.left));\n    var fromBWidth = (fromB ? fromB.width : parseFloat(from.style.width) || from.offsetWidth);\n    var fromBHeight = (fromB ? fromB.height : parseFloat(from.style.height) || from.offsetHeight);\n    var toBWidth = (toB ? toB.width : parseFloat(to.style.width) || to.offsetWidth);\n    var toBHeight = (toB ? toB.height : parseFloat(to.style.height) || to.offsetHeight);\n\n    var fT = fromBStartY + fromBHeight * getNumberOrDef(trafo && trafo.fromY, getNumberOrDef(trafo, 0.5));\n    var tT = toBStartY + toBHeight * getNumberOrDef(trafo && trafo.toY, getNumberOrDef(trafo, 0.5));\n    var fL = fromBStartX + fromBWidth * getNumberOrDef(trafo && trafo.fromX, getNumberOrDef(trafo, 0.5));\n    var tL = toBStartX + toBWidth * getNumberOrDef(trafo && trafo.toX, getNumberOrDef(trafo, 0.5));\n\n    var CA   = Math.abs(tT - fT);\n    var CO   = Math.abs(tL - fL);\n    var H    = Math.sqrt(CA*CA + CO*CO);\n    var ANG  = 180 / Math.PI * Math.acos( CO/H );\n\n    if((fT >= tT || fL >= tL) && (tT >= fT || tL >= fL)) {\n      ANG *= -1;\n    }\n\n    if (trafo && trafo.onlyVisible) {\n      var arrangeFrom = intersectionPoint(fL, fT, tL, tT, fromBStartX, fromBStartY, fromBStartX + fromBWidth, fromBStartY + fromBHeight);\n      var arrangeTo = intersectionPoint(fL, fT, tL, tT, toBStartX, toBStartY, toBStartX + toBWidth, toBStartY + toBHeight);\n\n      if (arrangeFrom) {\n        fL = arrangeFrom.x;\n        fT = arrangeFrom.y;\n      }\n      if (arrangeTo) {\n        tL = arrangeTo.x;\n        tT = arrangeTo.y;\n      }\n      CA   = Math.abs(tT - fT);\n      CO   = Math.abs(tL - fL);\n      H    = Math.sqrt(CA*CA + CO*CO);\n    }\n\n    var top  = (tT+fT)/2 - W/2;\n    var left = (tL+fL)/2 - H/2;\n\n    var arrows  = [...line.getElementsByClassName('arrow')];\n\n    var needSwap = (fL > tL || (fL == tL && fT < tT));\n    var arrowFw = needSwap && isVisible(arrows[0]) && arrows[0] || !needSwap && isVisible(arrows[1]) && arrows[1];\n    var arrowBw = !needSwap && isVisible(arrows[0]) && arrows[0] || needSwap && isVisible(arrows[1]) && arrows[1];\n    if (arrowFw) {\n      arrowFw.classList.remove('arrow-bw');\n      arrowFw.classList.add('arrow-fw');\n      arrowFw.style.borderRightColor = color;\n      arrowFw.style.top = W/2-6 + \"px\";\n    }\n    if (arrowBw) {\n      arrowBw.classList.remove('arrow-fw');\n      arrowBw.classList.add('arrow-bw');\n      arrowBw.style.borderLeftColor = color;\n      arrowBw.style.top = W/2-6 + \"px\";\n    }\n    line.style.display = \"none\";\n    line.style[\"-webkit-transform\"] = 'rotate('+ ANG +'deg)';\n    line.style[\"-moz-transform\"] = 'rotate('+ ANG +'deg)';\n    line.style[\"-ms-transform\"] = 'rotate('+ ANG +'deg)';\n    line.style[\"-o-transform\"] = 'rotate('+ ANG +'deg)';\n    line.style[\"-transform\"] = 'rotate('+ ANG +'deg)';\n    line.style.top    = top+'px';\n    line.style.left   = left+'px';\n    line.style.width  = H + 'px';\n    line.style.height = W + 'px';\n    line.style.background = \"linear-gradient(to right, \" +\n      (arrowFw ? \"transparent\" : color) +\" 11px, \" +\n      color + \" 11px \" + (H - 11) + \"px, \" +\n      (arrowBw ? \"transparent\" : color) + \" \" + (H - 11) + \"px 100%)\";\n    line.style.display = \"initial\";\n  }\n\n  function repaintConnection(connectionElement) {\n    var fromQ = connectionElement.getAttribute('from');\n    var fromE = document.querySelector(fromQ);\n    var toQ = connectionElement.getAttribute('to');\n    var toE = document.querySelector(toQ);\n    connectedObserver.observe(fromE, {attributes:true});\n    connectedObserver.observe(toE, {attributes:true});\n\n    var lineE = connectionElement.getElementsByClassName('line')[0];\n    if (!lineE) {\n      lineE = document.createElement('div');\n      lineE.classList.add('line');\n      connectionElement.appendChild(lineE);\n    }\n    var needTail = connectionElement.hasAttribute('tail');\n    var needHead = connectionElement.hasAttribute('head');\n    var arrows = lineE.getElementsByClassName('arrow');\n    var tail = arrows[0];\n    var head = arrows[1];\n    if (!tail && (needHead || needTail)) {\n      tail = document.createElement('div');\n      tail.classList.add('arrow');\n      lineE.appendChild(tail);\n    }\n\n    if (!head && needHead) {\n      head = document.createElement('div');\n      head.classList.add('arrow');\n      lineE.appendChild(head);\n    }\n\n    tail && (tail.style.visibility = needTail ? 'visible' : 'hidden');\n    head && (head.style.visibility = needHead ? 'visible' : 'hidden');\n\n    var textE = lineE.getElementsByClassName('text')[0];\n    var textMessage = connectionElement.getAttribute('text');\n\n    if (!textE && textMessage) {\n      textE = document.createElement('div');\n      textE.classList.add('text');\n      lineE.appendChild(textE);\n    }\n    if (textE && textE.innerText != textMessage) {\n      textE.innerText = textMessage;\n    }\n\n    adjustLine(fromE, toE, lineE, {\n      color: connectionElement.getAttribute('color'),\n      onlyVisible: connectionElement.hasAttribute('onlyVisible'),\n      fromX: parseFloat(connectionElement.getAttribute('fromX')),\n      fromY: parseFloat(connectionElement.getAttribute('fromY')),\n      toX: parseFloat(connectionElement.getAttribute('toX')),\n      toY: parseFloat(connectionElement.getAttribute('toY')),\n      width: parseFloat(connectionElement.getAttribute('width'))\n    });\n  }\n\n  function repaintWithoutObserve(tag) {\n    connectionObserver.observe(tag, {attributeFilter: []});\n    repaintConnection(tag);\n    connectionObserver.observe(tag, {attributes:true, childList:true, subtree: true});\n  }\n\n  function createOne(newElement) {\n    connectionElements.push(newElement);\n    repaintConnection(newElement);\n    connectionObserver.observe(newElement, {attributes:true, childList:true, subtree: true});\n  }\n\n  function create() {\n    bodyObserver.observe(document.body, {childList:true, subtree: true});\n    [...document.body.getElementsByTagName('connection')].forEach(createOne);\n  }\n\n  function removeConnection(tag) {\n    for(var i = connectionElements.length - 1; i >= 0; i--)\n      if(connectionElements[i] === tag)\n        connectionElements.splice(i, 1);\n\n    connectionObserver.observe(tag, {attributeFilter: []});\n  }\n\n  function changedConnectedTag(changes) {\n    changes.forEach(e => {\n      var changedElem = e.target;\n      var wasConnection = false;\n      for (var i = 0; i < connectionElements.length; ++i) {\n        var fromE = document.querySelector(connectionElements[i].getAttribute('from'));\n        if (fromE === changedElem) {\n          wasConnection = true;\n          repaintWithoutObserve(connectionElements[i]);\n          continue;\n        }\n        var toE = document.querySelector(connectionElements[i].getAttribute('to'));\n        if (toE === changedElem) {\n          wasConnection = true;\n          repaintWithoutObserve(connectionElements[i]);\n        }\n      }\n      if (!wasConnection) {\n        connectionObserver.observe(changedElem, {attributeFilter: []});\n      }\n    });\n  }\n\n  function changedConnectionTag(changes) {\n    changes.forEach(e => {\n      var conn = e.target;\n      if (conn.tagName.toLowerCase() !== 'connection' && e.attributeName === 'class')\n        ;\n      while (conn && conn.tagName.toLowerCase() !== 'connection')\n        conn = conn.parentElement;\n      if (!conn) return;\n      repaintWithoutObserve(conn);\n    });\n  }\n\n  function bodyNewElement(changes) {\n    changes.forEach(e => {\n      e.removedNodes.forEach(n => {\n        if (n.tagName && n.tagName.toLowerCase() === 'connection')\n          removeConnection(n);\n      });\n      e.addedNodes.forEach(n => {\n        if (n.tagName && n.tagName.toLowerCase() === 'connection')\n          createOne(n);\n      });\n    });\n  }\n\n  var connectionElements = [];\n  var MutationObserver = window.MutationObserver ||\n    window.WebKitMutationObserver || window.MozMutationObserver;\n  var bodyObserver = new MutationObserver(bodyNewElement);\n  var connectionObserver = new MutationObserver(changedConnectionTag);\n  var connectedObserver = new MutationObserver(changedConnectedTag);\n  document.body && create() || window.addEventListener(\"load\", create);\n})();\n\n\n"]},"metadata":{},"sourceType":"module"}